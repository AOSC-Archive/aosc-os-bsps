From 7b9f6dbdff262632de793cbe8ce657fd6302b2f4 Mon Sep 17 00:00:00 2001
From: Dan Johansen <strit@manjaro.org>
Date: Sun, 7 Jun 2020 19:21:45 +0200
Subject: [PATCH] arm64: dts: rockchip: fix roc-cc dts

---
 .../arm64/boot/dts/rockchip/rk3328-roc-cc.dts | 72 ++++++++++++++++---
 1 file changed, 63 insertions(+), 9 deletions(-)

diff --git a/arch/arm64/boot/dts/rockchip/rk3328-roc-cc.dts b/arch/arm64/boot/dts/rockchip/rk3328-roc-cc.dts
index 34db48c274e5..59201eadfbf8 100644
--- a/arch/arm64/boot/dts/rockchip/rk3328-roc-cc.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3328-roc-cc.dts
@@ -102,6 +102,35 @@ user_led: led-1 {
 			mode = <0x05>;
 		};
 	};
+	
+	sound {
+		compatible = "audio-graph-card";
+		label = "rockchip,rk3328";
+		dais = <&i2s1_p0
+			&spdif_p0>;
+	};
+
+	spdif-dit {
+		compatible = "linux,spdif-dit";
+		#sound-dai-cells = <0>;
+
+		port {
+			dit_p0_0: endpoint {
+				remote-endpoint = <&spdif_p0_0>;
+			};
+		};
+	};
+};
+
+&codec {
+	mute-gpios = <&grf_gpio 0 GPIO_ACTIVE_LOW>;
+	status = "okay";
+
+	port@0 {
+		codec_p0_0: endpoint {
+			remote-endpoint = <&i2s1_p0_0>;
+		};
+	};
 };
 
 &cpu0 {
@@ -270,6 +299,18 @@ regulator-state-mem {
 	};
 };
 
+&i2s1 {
+	status = "okay";
+
+	i2s1_p0: port {
+		i2s1_p0_0: endpoint {
+			dai-format = "i2s";
+			mclk-fs = <256>;
+			remote-endpoint = <&codec_p0_0>;
+		};
+	};
+};
+
 &io_domains {
 	status = "okay";
 
@@ -313,35 +354,48 @@ &sdmmc {
 	status = "okay";
 };
 
-&tsadc {
+&spdif {
+	pinctrl-0 = <&spdifm0_tx>;
 	status = "okay";
-};
 
-&u2phy {
-	status = "okay";
+	spdif_p0: port {
+		spdif_p0_0: endpoint {
+			remote-endpoint = <&dit_p0_0>;
+		};
+	};
 };
 
-&u2phy_host {
+&tsadc {
 	status = "okay";
 };
 
-&u2phy_otg {
+&uart2 {
 	status = "okay";
 };
 
-&uart2 {
+&u2phy {
 	status = "okay";
+
+	u2phy_host: host-port {
+		status = "okay";
+	};
+
+	u2phy_otg: otg-port {
+		status = "okay";
+	};
 };
 
 &usb20_otg {
+	dr_mode = "host";
 	status = "okay";
 };
 
-&usb_host0_ehci {
+&usbdrd3 {
 	status = "okay";
 };
 
-&usb_host0_ohci {
+&usbdrd_dwc3 {
+	dr_mode = "host";
 	status = "okay";
 };
 
-- 
2.26.2

